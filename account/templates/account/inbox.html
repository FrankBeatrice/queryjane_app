{% extends "layout/index.html" %}
{% load static messages i18n %}

{% block title %}{% trans 'Inbox' %}{% endblock %}

{% block content %}
<section class="QjaneInbox">
    <div class="container">
        <div class="row">
          <div class="col-md-6 col-md-offset-3">

            {% get_user_messages_count user as user_messages_count %}
            {% get_new_user_messages_count user as new_user_messages_count %}

            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title">{% trans 'Inbox' %} - <span class="NewMessagesCounter">{{ new_user_messages_count }}</span> {% trans 'new messages.' %}</h3>
                </div>

                <div class="panel-body QjaneInboxList">
                    <table class="table">
                        {% for conversation in conversations_list %}
                        <tr class="{% if message.unread %}active{% endif %}">
                            <td>
                                <i class="JSMessagestatus fa {% if message.unread %}fa-envelope{% else %}fa-envelope-open{% endif %}" aria-hidden="true" title="{% if message.unread %}New message{% else %}Viewed message{% endif %}"></i>
                                <span> - {% trans 'From:' %} {{ conversation.get_last_message.user_from }}</span>
                                <p>{{ conversation.updated_at }}</p>

                                <a class="qjane-messages-link" href="javascript:void(0)" data-message-url="{% url 'account:ajax_post_conversation_load' conversation.pk  %}" data-toggle="modal" data-target="#generalModalMessage">
                                    {{ conversation.get_last_message.message|truncatechars:70 }}
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </table>
                </div>
            </div>
          </div>
        </div>
    </div>
</section>
{% endblock %}
